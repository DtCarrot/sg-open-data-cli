"main";let program;_e45‍.w("commander",[["default",["program"],function(v){program=v}]]);let path;_e45‍.w("path",[["default",["path"],function(v){path=v}]]);let fs;_e45‍.w("fs",[["default",["fs"],function(v){fs=v}]]);let prompts;_e45‍.w("prompts",[["default",["prompts"],function(v){prompts=v}]]);let download;_e45‍.w("download",[["default",["download"],function(v){download=v}]]);let sprintf;_e45‍.w("sprintf-js",[["sprintf",["sprintf"],function(v){sprintf=v}]]);let fetch;_e45‍.w("node-fetch",[["default",["fetch"],function(v){fetch=v}]]);







_e45‍.g.console.log('Running')
program.version('0.0.1').description('Contact management system')

program
  .command('list')
  .alias('a')
  .description('Add a contact')
  .action(async () => {
    const list = await fetch('https://data.gov.sg/api/action/package_list')
    const listJSON = await list.json()
    listJSON.result.map((obj, idx) => {
      _e45‍.g.console.log(sprintf('ID: %2.2d Name: %s', idx, obj))
    })
  })

program
  .command('download <package> <dest>')
  .alias('a')
  .description('download')
  .action(async (pkg, dest) => {
    const packageUrl = `https://data.gov.sg/api/action/package_show?id=${pkg}`
    const packageResult = await fetch(packageUrl)
    _e45‍.g.console.log('Result: ', packageResult)
    const packageJSON = await packageResult.json()
    const {
      result: { resources },
    } = packageJSON
    _e45‍.g.console.log(`There are ${resources.length} resources`)
    resources.map((obj, idx) => {
      _e45‍.g.console.log(`${idx} - ${obj.name}`)
    })
    const userResponse = await prompts({
      type: 'number',
      name: 'value',
      message: 'Which file you want to download?',
      validate: value => (value > resources.length ? 'Out of range' : true),
    })
    _e45‍.g.console.log('Response: ', userResponse)
    let { value } = userResponse
    let { url } = resources[value]
    _e45‍.g.console.log('Url: ', url)
    const urlSplit = url.split('.')
    const ext = urlSplit[urlSplit.length - 1]
    _e45‍.g.console.log('Ext: ', ext)
    // const downloadData = await fetch(url)
    // downloadData.pipe(fs.createWriteStream(`./test.${ext}`))
    const filePath = path.format({
      dir: dest,
      name: resources[value].name,
      ext: `.${ext}`,
    })
    download(url).pipe(fs.createWriteStream(filePath))
  })

program.parse(process.argv)
